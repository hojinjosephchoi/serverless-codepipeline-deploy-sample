#!/bin/bash

SELF="${BASH_SOURCE[0]}"
cd `dirname "$SELF"`
cd ..

while :; do
  case $1 in
    --clean)
      CLEAN=true
      ;;
    *)
      if [ -z "$1" ]; then break; fi
  esac
  shift
done

install () {
  local APP=$1
  echo ============================================================
  if [[ "$CLEAN" = "true" ]]; then
    echo "Installing on $APP (clean install)"
  else
    echo "Installing on $APP"
  fi
  echo ============================================================
  if [[ "$CLEAN" = "true" ]]; then
    ( cd $APP ; rm -rf node_modules )
  fi
  ( cd $APP ; npm prune ; npm install )
}

for project in services/*; do
  install $project
done
